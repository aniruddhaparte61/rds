{ 
"Parameters": {
    "DBName": {
      "Default": "MyDatabase",
      "Description" : "The database name",
      "Type": "String",
      "MinLength": "1",
      "MaxLength": "64",
      "AllowedPattern" : "[a-zA-Z][a-zA-Z0-9]*"
    },

    "DBUser": {
      "Description" : "The database admin account username",
      "Type": "String",
      "MinLength": "1",
      "MaxLength": "16",
      "AllowedPattern" : "[a-zA-Z][a-zA-Z0-9]*"
    },

    "DBPassword": {
      "Description" : "The database admin account password",
      "Type": "String",
      "MinLength": "1",
      "MaxLength": "41",
      "AllowedPattern" : "[a-zA-Z0-9]+"
    },

    "DBAllocatedStorage": {
      "Default": "5",
      "Description" : "The size of the database (Gb)",
      "Type": "Number",
      "MinValue": "5",
      "MaxValue": "1024"
      },
	  
    "DBInstanceClass": {
      "Description" : "The database instance type",
      "Type": "String"
    },
	"DBAvailabilityZone": {
	 "Description" : "Select Zone",
      "Type": "String"
	},
	"DBInstanceIdentifier": {
	"Description" : "Select Zone",
    "Type": "String"
	}
  },
"Resources": {
        "MyDB": {
            "Type": "AWS::RDS::DBInstance",
            "Properties": {
                "AllocatedStorage": { "Ref" : "DBAllocatedStorage" },
                "AvailabilityZone": { "Ref" : "DBAvailabilityZone" },
                "DBInstanceClass": { "Ref" : "DBInstanceClass" },
                "DBInstanceIdentifier": { "Ref" : "DBInstanceIdentifier" },
                "DBName": { "Ref" : "DBName" },
                "DeleteAutomatedBackups": true,
                "Engine": "MySQL",
				"EngineVersion" : "5.7.22",
                "MasterUsername": { "Ref" : "DBUser" },
                "MasterUserPassword": { "Ref" : "DBPassword" },
                "Port": "3306",
                "PubliclyAccessible": true,
				"Tags" : [{ "Key"  : "Name", "Value" : "Master Database" }],
				"VPCSecurityGroups" : [ { "Fn::GetAtt": [ "DBEC2SecurityGroup", "GroupId" ]}]
        }
		},
		
		"DBEC2SecurityGroup": {
					"Type": "AWS::EC2::SecurityGroup",
					"Properties" : {
							"GroupDescription": "Open database for access",
							"SecurityGroupIngress" : [{
										"IpProtocol" : "tcp",
										"FromPort" : "3306",
										"ToPort" : "3306",
										"CidrIp" : "202.189.245.70/32"
        }]
      }
    }
		 
    }
}
